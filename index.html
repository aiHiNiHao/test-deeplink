<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>正在返回应用...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; color: #333; }
        .button { 
            display: inline-block; padding: 12px 24px; 
            background: #4285f4; color: white; 
            text-decoration: none; border-radius: 5px;
            font-weight: bold; margin-top: 20px;
        }
        .loader { color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <h2>登录授权完成</h2>
    <p id="status">正在尝试自动为您打开 App...</p>
    
    <div class="loader">如果页面没有自动跳转，请点击下方按钮</div>
    
    <a href="javascript:void(0)" id="manualBtn" class="button">点击手动返回 App</a>

    <script>
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    if (code) {
        // 使用 Intent Scheme 强拉，这是最稳妥的，因为它指名道姓要找你的包名
        const intentUrl = "intent://aihinihao.github.io/test-deeplink/?code=" + code + "#Intent;scheme=https;package=io.bilian.cfpwt.sunx.dev;end";

        // 绑定手动按钮
        document.getElementById('manualBtn').onclick = function() {
            window.location.replace(intentUrl);
        };

        // 自动执行：直接使用 Intent Scheme 强拉，不要跳转回 HTTPS 首页
        console.log('正在通过 Intent 协议唤起 App...');
        
        // 延迟 300ms 执行，给浏览器渲染和系统响应留一点时间
        setTimeout(() => {
            window.location.replace(intentUrl); 
        }, 300);

        // 如果 3 秒后还在网页，说明唤起失败，提示手动点击
        setTimeout(() => {
            document.getElementById('status').innerText = "自动跳转失败，请点击下方按钮手动返回";
        }, 3000);

    } else {
        document.getElementById('status').innerText = "未检测到有效授权信息。";
    }
</script>
</body>
</html>
